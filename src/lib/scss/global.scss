*,
*::before,
*::after {
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;

    --background: white;
    --text: black;
    --primary: #9309de;
    --secondary: black;
    --gray: #565656;
    --dark-gray: #383838;
    --light-gray: #c7c7c7;
    --success: #3bdd72;
    --error: #ff4747;

    --padding-xs: 0.25rem;
    --padding-sm: 0.5rem;
    --padding-smd: 0.75rem;
    --padding-md: 1rem;
    --padding-lg: 1.25rem;
    --padding-xl: 1.5rem;
    --padding-2xl: 1.75rem;
    --padding-3xl: 2rem;

    --shadow-outline: 0px 0px 2px 0px rgba(0, 0, 0, 0.25);
    --shadow-outline-thick: 0px 0px 4px 0px rgba(0, 0, 0, 0.3);
    --shadow-outline-success: 0px 0px 4px 0px var(--success);
    --shadow-outline-error: 0px 0px 4px 0px var(--error);
    --shadow-sm-light: 0px 1px 4px 0px rgba(0, 0, 0, 0.25);
    --shadow-sm-medium: 0px 1px 4px 0px rgba(0, 0, 0, 0.5);
    --shadow-sm-heavy: 0px 1px 4px 0px rgba(0, 0, 0, 0.75);
    --shadow-sm-black: 0px 1px 4px 0px rgba(0, 0, 0, 1);

    --page-padding: var(--padding-3xl);
    @media screen and (max-width: 27.5rem) {
        --page-padding: var(--padding-md);
    }
}

* {
    margin: 0;
}

body {
    -webkit-font-smoothing: antialiased;
}

img,
picture,
video,
canvas,
svg {
    display: block;
    max-width: 100%;
}

input,
button,
textarea,
select {
    font: inherit;
}

p,
h1,
h2,
h3,
h4,
h5,
h6 {
    overflow-wrap: break-word;
}

#root,
#__next {
    isolation: isolate;
}

h1 {
    @include title-lg;
}

h2 {
    @include title-md;
}

h3,
h4 {
    @include title-sm;
}

p {
    color: var(--gray);
    @include paragraph-lg;
}

a {
    color: inherit;
}

.prose,
.explanation > p > div {
    & > p,
    & > .note,
    // & > ul,
    // & > ol,
    & > blockquote,
    & > table,
    & > .code-container,
    & > .container:has(.editable-code-container),
    & > .quiz {
        margin: var(--padding-md) 0;
    }

    blockquote {
        padding: var(--padding-sm) var(--padding-md);
        border-left: 2px solid var(--primary);

        & > *:not(ol, ul) {
            margin: var(--padding-md) 0;
        }

        h3,
        h4 {
            margin-bottom: var(--padding-xl);
        }

        *:first-child {
            margin-top: 0;
        }

        *:last-child {
            margin-bottom: 0;
        }

        blockquote {
            margin: var(--padding-xl) 0;
        }
    }

    table {
        border-spacing: 0;
        border-radius: 0.5rem;
        border: 1px solid var(--primary);
        @include paragraph-lg;

        th,
        td {
            border: 1px solid var(--primary);
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 0.5rem;
        }

        tr:last-child td:last-child {
            border-bottom-right-radius: 0.5rem;
        }

        thead tr th:first-child {
            border-top-left-radius: 0.5rem;
        }

        thead tr th:last-child {
            border-top-right-radius: 0.5rem;
        }

        td,
        th {
            padding: var(--padding-sm);
        }

        td {
            color: var(--gray);
        }
    }

    .code-container {
        min-width: 0;
        display: grid;
        overflow-x: auto;
        border-radius: 0.5rem;
        border: 2px solid var(--primary);
    }

    // .container:has(.editable-code-container) {
    //     margin-top: var(--padding-xs);
    // }

    pre:has(code) {
        overflow: auto;
        width: 100%;
        font-size: 1.125rem;
        line-height: 1.5rem;
        padding: var(--padding-xl) 0;
        background-color: transparent !important;

        code {
            width: auto;
            min-width: 100%;
            display: inline-block;
            padding: 0 var(--padding-xl);
            background-color: transparent;
            border-radius: 0;

            span.line {
                width: 100%;
                display: inline-block;
            }
        }
    }

    pre.has-diff,
    pre.has-highlighted {
        span.line {
            margin: 0 -1.5rem;
            padding: 0 1.5rem;
            width: calc(100% + 3rem);
        }
    }

    pre.has-diff {
        span.line.diff {
            position: relative;

            &::before {
                position: absolute;
                left: 0.5rem;
                font-size: 1rem;
            }

            &.remove {
                background-color: #f8e7ea;

                &::before {
                    content: '-';
                    color: #b34e52;
                }
            }

            &.add {
                background-color: #daf0e8;

                &::before {
                    content: '+';
                    color: #18794e;
                }
            }
        }
    }

    pre.has-highlighted {
        span.line.highlighted {
            background-color: #eaebee;

            &.error {
                background-color: #f8dfe4;
            }

            &.warning {
                background-color: #f7efdb;
            }
        }
    }

    pre.has-focused {
        span.line:not(.focused) {
            opacity: 0.7;
            filter: blur(0.1rem);
            transition:
                filter 300ms,
                opacity 300ms;
        }

        &:hover span.line:not(.focused) {
            opacity: 1;
            filter: blur(0);
        }
    }

    code {
        padding: 0.25rem 0.25rem;
        background-color: #efefef;
        border-radius: 0.25rem;
    }

    .explanation > p > div > *:first-child {
        margin-top: 0;
    }

    .explanation > p > div > *:last-child {
        margin-bottom: 0;
    }

    h1,
    h2,
    h3,
    h4 {
        width: fit-content;
    }

    h4 {
        color: var(--text);
    }

    & > h1,
    & > h3,
    h4 {
        margin-top: 3rem;
    }

    & > h2 {
        margin-top: 4rem;
    }

    hr {
        margin-top: 3rem;
        margin-bottom: 1rem;
        border: 1px solid var(--primary);
    }

    h2:has(a[aria-hidden='true']),
    h3:has(a[aria-hidden='true']) {
        scroll-margin-top: var(--padding-md);

        a[aria-hidden='true'] {
            position: relative;

            .icon-link {
                position: absolute;
                opacity: 0;
                top: 0;
                left: 0.5rem;
                transition: opacity 300ms;

                &::before {
                    content: '#';
                }
            }
        }

        &:hover a[aria-hidden='true'] {
            .icon-link {
                opacity: 1;
            }
        }
    }

    sup:has(a.footnote-ref) {
        scroll-margin-top: var(--padding-md);
    }

    a.footnote-backref {
        margin-left: var(--padding-sm);
    }

    h3:has(+ ul),
    h3:has(+ ol),
    h4:has(+ ul),
    h4:has(+ ol) {
        margin-bottom: var(--padding-md);
    }

    ul,
    ol {
        display: flex;
        flex-direction: column;

        .code-container,
        .container:has(.editable-code-container) {
            margin: var(--padding-md) 0;
        }
    }

    ul > li,
    ol > li {
        color: var(--gray);
        margin: var(--padding-xs) 0;
        @include paragraph-lg();
    }

    p:has(+ ul),
    p:has(+ ol) {
        margin-bottom: var(--padding-sm);
    }

    // & > *:has(+ h2, + h3) {
    //     margin-bottom: 0 !important;
    // }

    @media screen and (max-width: 47.9375rem) {
        & > h1,
        & > h3,
        & > h4 {
            margin-top: 2rem;
        }

        & > h2 {
            margin-top: 3rem;
        }
    }

    a {
        color: var(--primary);

        &:visited {
            color: var(--primary);
        }
    }
}
